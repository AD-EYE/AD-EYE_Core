<!DOCTYPE html>
<html>
<head>

    <title>AD-EYE</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
    	 crossorigin="anonymous">
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="gauge.css">
        <script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
        <script type="text/javascript" src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
        <script type="text/javascript" type="text/javascript">
//------------------Connection with the bridge-------------------
                    var ros = new ROSLIB.Ros({
                      url : 'ws://localhost:9090'
                    });

                    ros.on('connection', function() {
                      document.getElementById("status").innerHTML = "Connected";
                    });

                    ros.on('error', function(error) {
                      document.getElementById("status").innerHTML = "Error";
                    });

                    ros.on('close', function() {
                      document.getElementById("status").innerHTML = "Closed";
                    });
//------------------Connection with the bridge-------------------

//-------------------linear velocity----------------
                    var vel_listener = new ROSLIB.Topic({
                      ros : ros,
                      name : '/vehicle_cmd',
                      messageType : 'autoware_msgs/VehicleCmd'
                    });

                    vel_listener.subscribe(function(message) {
                      console.log('Received message on ' + vel_listener.name + ': ' + message.ctrl_cmd.linear_velocity);
                      document.getElementById("msg").innerHTML = message.ctrl_cmd.linear_velocity;

                     var val = message.ctrl_cmd.linear_velocity;
                     const gaugeElement = document.querySelector(".gauge");
                     val = val / 10;
                         function setGaugeValue(gauge, value) {
                           if (value < 0 || value > 1) {
                             return;
                           }

                           gauge.querySelector(".gauge__fill").style.transform = `rotate(${value / 3}turn)`;
                           value = (value * 180) / 5;
                           gauge.querySelector(".gauge__cover").textContent = `${Math.round(value )}km/hr`;
                         }

                     setGaugeValue(gaugeElement, val);
                     });
//-------------------linear velocity----------------

//-------------------linear acceleration----------------
                        var acc_listener = new ROSLIB.Topic({
                          ros : ros,
                          name : '/vehicle_cmd',
                          messageType : 'autoware_msgs/VehicleCmd'
                        });

                        acc_listener.subscribe(function(message) {
                         console.log('Received message on ' + acc_listener.name + ': ' + message.ctrl_cmd.linear_acceleration);
                          document.getElementById("acc").innerHTML = message.ctrl_cmd.linear_acceleration;

                         var val_a = message.ctrl_cmd.linear_acceleration;
                        const gaugeElement_a = document.querySelector(".gauge_a");
                        val_a = val_a / 10;
                         function setGaugeValue_a(gauge_a, value_a) {
                           if (value_a < 0 || value_a > 1) {
                             return;
                           }

                           gauge_a.querySelector(".gauge_a__fill").style.transform = `rotate(${value_a / 4}turn)`;

                           gauge_a.querySelector(".gauge_a__cover").textContent = `${Math.round(value_a*10 )}m/s2`;
                         }

                         setGaugeValue_a(gaugeElement_a, val_a);
                         });
//-------------------linear acceleration----------------

//-------------------safety Vs autoware ----------------

                     var data_listener = new ROSLIB.Topic({
                       ros : ros,
                       name : '/switchCommand',
                       messageType : 'std_msgs/Int32'
                     });

                     data_listener.subscribe(function(message) {
                     console.log('Received message on ' + data_listener.name + ': ' + message.data);
                     document.getElementById("data").innerHTML = message.data;

                      var val_data = message.data;
                      var num =val_data;
                      var strColorPairs = Array(
                                                  {'position' : 0, 'color' : 'green'},
                                                  {'position' : 1, 'color' : 'red'}
                                              );

                      var position = checkPosition(num);
                      colorBox(position);
                       function colorBox(position)
                          {
                              var divList = document.getElementsByClassName('ratingBox');
                              var i, n = divList.length;
                              curContent = divList[position].id;
                              console.log(curContent);
                              for (i=0; i<n; i++)
                              {

                                  for (j=0; j<strColorPairs.length; j++)
                                  {
                                      if (strColorPairs[j].position == curContent){
                                          divList[curContent].style.backgroundColor  = strColorPairs[j].color;
                                          }
                                      else {divList[i].style.backgroundColor  = 'gray'}
                                  }
                              }
                          }

                      function checkPosition(num){
                       var position;
                         if((num==0))
                           {
                            position=0;
                           }
                           else if((num==1))
                           {
                            position=1;
                           }

                           return position;
                       }
                    });
//-------------------safety Vs autoware ----------------

         </script>

</head>


<body class="d-flex flex-column h-100">
	<!-- header of the page -->
	<header class="header">
		<div class="container">
			<div class="jumbotron text-center">
				<h1>AD-EYE Graphical Interface</h1>
				<p>Connection status: <span id="status"></span></p>
                <p>Last /txt_msg received_velocity: <span id="msg"></span></p>
                <p>Last /txt_msg received_acceleration: <span id="acc"></span></p>
                <p>Last /txt_msg received_data: <span id="data"></span></p>
			</div>
		</div>
	</header>

	<!-- main content -->
	<main>
		<div class="container">
			<div class="row">
				<div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Linear Velocity</h2>
                            <div class="gauge">
                                <div class="gauge__body">
                                    <div class="gauge__fill"></div>
                                    <div class="gauge__cover"></div>
                                </div>
                            </div>
						</div>
					</div>
				</div>
				<div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Linear Acceleration</h2>
                            <div class="gauge_a">
                                <div class="gauge_a__body">
                                    <div class="gauge_a__fill"></div>
                                    <div class="gauge_a__cover"></div>
                                </div>
                            </div>
						</div>
					</div>
				</div>
                <div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Autoware Vs Safety</h2>
                            <div id="0" class="ratingBox">
                            </div>
                            <p>Autoware</p>
                            <div id="1" class="ratingBox">
                            </div>
                            <p>Safety Channel</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>

	<!-- footer -->
	<footer class="footer mt-auto bg-dark text-light">
		<div class="container">
			<h5>page ends here! But work inprogress</h5>
		</div>
	</footer>
</body>


</html>
