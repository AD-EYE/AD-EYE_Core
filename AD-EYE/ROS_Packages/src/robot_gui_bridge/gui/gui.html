<!DOCTYPE html>
<html>
<head>

    <title>AD-EYE</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
    	 crossorigin="anonymous">
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="gauge.css">

        <script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
        <script type="text/javascript" src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
        <script type="text/javascript" type="text/javascript">
//------------------Connection with the bridge-------------------
                    var ros = new ROSLIB.Ros({
                      url : 'ws://localhost:9090'
                    });

                    ros.on('connection', function() {
                      document.getElementById("status").innerHTML = "Connected";
                    });

                    ros.on('error', function(error) {
                      document.getElementById("status").innerHTML = "Error";
                    });

                    ros.on('close', function() {
                      document.getElementById("status").innerHTML = "Closed";
                    });
//------------------Connection with the bridge-------------------

//-------------------linear velocity----------------
                //listen to the topic
                    var vel_listener = new ROSLIB.Topic({
                      ros : ros,
                      name : '/vehicle_cmd',
                      messageType : 'autoware_msgs/VehicleCmd'
                    });
                    //subscribing to the topic
                    vel_listener.subscribe(function(message) {


                     var val = message.ctrl_cmd.linear_velocity;
                     const gaugeElement = document.querySelector(".gauge");
                     val = val / 10; //shifting one decimal
                        //function to set values of the gauge
                         function setGaugeValue(gauge, value) {
                             //safety check for the values within the range
                           if (value < 0 || value > 1) {
                             return;
                           }
                           //making the turn over the gauge body
                           gauge.querySelector(".gauge__fill").style.transform = `rotate(${value / 3}turn)`;
                           value = (value * 180) / 5;// to convert the value to km/hr from m/s
                           //printing the velocity value
                           gauge.querySelector(".gauge__cover").textContent = `${Math.round(value )}km/hr`;
                         }
                         // passing the value to the function
                     setGaugeValue(gaugeElement, val);
                     });
//-------------------linear velocity----------------

//-------------------linear acceleration----------------
                    //listen to the topic
                        var acc_listener = new ROSLIB.Topic({
                          ros : ros,
                          name : '/vehicle_cmd',
                          messageType : 'autoware_msgs/VehicleCmd'
                        });
                        //subscribing to the topic
                        acc_listener.subscribe(function(message) {


                         var val_a = message.ctrl_cmd.linear_acceleration;
                        const gaugeElement_a = document.querySelector(".gauge_a");
                        val_a = val_a / 10; //shifting one decimal
                        //function to set values of the gauge
                         function setGaugeValue_a(gauge_a, value_a) {
                             //safety check for the values within the range
                           if (value_a < 0 || value_a > 1) {
                             return;
                           }
                           //making the turn over the gauge body
                           gauge_a.querySelector(".gauge_a__fill").style.transform = `rotate(${value_a / 4}turn)`;
                            //printing the acceleration value
                           gauge_a.querySelector(".gauge_a__cover").textContent = `${Math.round(value_a*10 )}m/s2`;
                         }
                         // passing the value to the function
                         setGaugeValue_a(gaugeElement_a, val_a);
                         });
//-------------------linear acceleration----------------

//-------------------safety Vs autoware ----------------
                    //listen to the topic
                     var data_listener = new ROSLIB.Topic({
                       ros : ros,
                       name : '/switchCommand',
                       messageType : 'std_msgs/Int32'
                     });
                     //subscribing to the topic
                     data_listener.subscribe(function(message) {


                      var val_data = message.data;
                      var num =val_data;
                    // array for two leds
                      var strColorPairs = Array(
                                                  {'position' : 0, 'color' : 'green'},
                                                  {'position' : 1, 'color' : 'red'}
                                              );

                      var position = checkPosition(num);
                      colorBox(position);
                      //function to change the color of leds and reseting it to gray when not in use
                       function colorBox(position)
                          {
                              var divList = document.getElementsByClassName('ratingBox');
                              var i, n = divList.length;
                              curContent = divList[position].id;
                              for (i=0; i<n; i++)
                              {

                                  for (j=0; j<strColorPairs.length; j++)
                                  {
                                      if (strColorPairs[j].position == curContent){
                                          divList[curContent].style.backgroundColor  = strColorPairs[j].color;
                                          }
                                      else {divList[i].style.backgroundColor  = 'gray'}
                                  }
                              }
                          }
                          //function to assign the position in the array base on the data value recived
                      function checkPosition(num){
                       var position;
                         if((num==0))
                           {
                            position=0;
                           }
                           else if((num==1))
                           {
                            position=1;
                           }

                           return position;
                       }
                    });
//-------------------safety Vs autoware ----------------

//-------------------tracked object ----------------
                    var track_listener = new ROSLIB.Topic({
                      ros : ros,
                      name : '/tracked_objects',
                      messageType : 'autoware_msgs/DetectedObjectArray'
                    });

                    track_listener.subscribe(function(message) {

                         let object=[];
                         var k=0;

                         for (var i = 0; i < message.objects.length; i++) {
                             for (var j = 0; j < message.objects[i].label.length; j++) {
                                 object[k]=message.objects[i].label[j];
                                 k++;

                         }
                         s = object.join("")
                         document.getElementById("track").innerHTML = s;
                         x = message.objects[0].pose.position.x;
                         document.getElementById("x").innerHTML = x;
                         y = message.objects[0].pose.position.y;
                         document.getElementById("y").innerHTML = y;
                         z = message.objects[0].pose.position.z
                         document.getElementById("z").innerHTML = z;
                         object.splice(0, object.length);
                         }

                    });
//-------------------tracked object ----------------

//---------------------behaviour state--------------
                    var beh_listener = new ROSLIB.Topic({
                      ros : ros,
                      name : '/behavior_state',
                      messageType : 'visualization_msgs/MarkerArray'
                    });

                    beh_listener.subscribe(function(message) {

                         let marker=[];
                         var k=0;

                         for (var i = 0; i < message.markers.length; i++) {
                             for (var j = 0; j < message.markers[i].text.length; j++) {
                                 marker[k]=message.markers[i].text[j];
                                 k++;

                         }

                         t = marker.join("")
                         document.getElementById("beh").innerHTML = t;
                         marker.splice(0, marker.length);
                     }
                         });
//--------------------behaviour state---------------
//--------------------Toggle state---------------
                    function toggleState(item){
                       if(item.className == "on") {
                           item.className="off";
                          var dataToggleOn = new ROSLIB.Topic({
                             ros : ros,
                             name : '/switchCommand',
                             messageType : 'std_msgs/Int32'
                           });

                          var dataOn = new ROSLIB.Message({
                             data : 1
                           });
                        dataToggleOn.publish(dataOn);
                       } else {
                           item.className="on";
                          var dataToggleOff = new ROSLIB.Topic({
                             ros : ros,
                             name : '/switchCommand',
                             messageType : 'std_msgs/Int32'
                           });

                          var dataOff = new ROSLIB.Message({
                             data : 0
                           });
                        dataToggleOff.publish(dataOff);
                       }
                    }
//--------------------Toggle state---------------
//-------------------- state Change---------------
                function toggleStateinitial(item){
                   if(item.className == "on") {
                       item.className="off";
                      var initialToggleOn = new ROSLIB.Topic({
                         ros : ros,
                         name : '/initial_checks',
                         messageType : 'std_msgs/Int32'
                       });

                      var initialOn = new ROSLIB.Message({
                         data : 1
                       });
                    initialToggleOn.publish(initialOn);
                   } else {
                       item.className="on";
                      var initialToggleOff = new ROSLIB.Topic({
                         ros : ros,
                         name : '/initial_checks',
                         messageType : 'std_msgs/Int32'
                       });

                      var initialOff = new ROSLIB.Message({
                         data : 0
                       });
                    initialToggleOff.publish(initialOff);
                   }
                }

                function toggleStateactivation(item){
                   if(item.className == "on") {
                       item.className="off";
                      var activationToggleOn = new ROSLIB.Topic({
                         ros : ros,
                         name : '/activation_request',
                         messageType : 'std_msgs/Int32'
                       });

                      var activationOn = new ROSLIB.Message({
                         data : 1
                       });
                    activationToggleOn.publish(activationOn);
                   } else {
                       item.className="on";
                      var activationToggleOff = new ROSLIB.Topic({
                         ros : ros,
                         name : '/activation_request',
                         messageType : 'std_msgs/Int32'
                       });

                      var acivationOff = new ROSLIB.Message({
                         data : 0
                       });
                    activationToggleOff.publish(activationOff);
                   }
                }

                function toggleStatefault(item){
                   if(item.className == "on") {
                       item.className="off";
                      var faultToggleOn = new ROSLIB.Topic({
                         ros : ros,
                         name : '/fault',
                         messageType : 'std_msgs/Int32'
                       });

                      var fautOn = new ROSLIB.Message({
                         data : 1
                       });
                    faultToggleOn.publish(faultOn);
                   } else {
                       item.className="on";
                      var faultToggleOff = new ROSLIB.Topic({
                         ros : ros,
                         name : '/fault',
                         messageType : 'std_msgs/Int32'
                       });

                      var faultOff = new ROSLIB.Message({
                         data : 0
                       });
                    faultToggleOff.publish(faultOff);
                   }
                }
//-------------------- state Change---------------
//-------------------Manager State----------------
                    //listen to the topic
                     var initial_listener = new ROSLIB.Topic({
                       ros : ros,
                       name : '/initial_checks',
                       messageType : 'std_msgs/Int32'
                     });
                     var activation_listener = new ROSLIB.Topic({
                       ros : ros,
                       name : '/activation_request',
                       messageType : 'std_msgs/Int32'
                     });
                     var fault_listener = new ROSLIB.Topic({
                       ros : ros,
                       name : '/fault',
                       messageType : 'std_msgs/Int32'
                     });
                     //subscribing to the topic
                    initial_listener.subscribe(function(message) {


                      var val_data = message.data;
                      var num =val_data;
                    // array for two leds
                      var strColorPairs = Array(
                                                  {'position' : 1, 'color' : 'green'},
                                              );

                      var position = checkPosition(num);
                      colorBox(position);
                      //function to change the color of leds and reseting it to gray when not in use
                       function colorBox(position)
                          {
                              var divList = document.getElementsByClassName('ratingBox');
                              var i, n = divList.length;
                              curContent = divList[position].id;
                              for (i=0; i<n; i++)
                              {

                                  for (j=0; j<strColorPairs.length; j++)
                                  {
                                      if (strColorPairs[j].position == curContent){
                                          divList[curContent].style.backgroundColor  = strColorPairs[j].color;
                                          }
                                      else {divList[i].style.backgroundColor  = 'gray'}
                                  }
                              }
                          }
                          //function to assign the position in the array base on the data value recived
                      function checkPosition(num){
                       var position;
                         if((num==1))
                           {
                            position=1;
                           }
                           return position;
                       }
                    });

                    activation_listener.subscribe(function(message) {


                      var val_data = message.data;
                      var num =val_data;
                    // array for two leds
                      var strColorPairs = Array(
                                                  {'position' : 0, 'color' : 'green'},
                                              );

                      var position = checkPosition(num);
                      colorBox(position);
                      //function to change the color of leds and reseting it to gray when not in use
                       function colorBox(position)
                          {
                              var divList = document.getElementsByClassName('ratingBox');
                              var i, n = divList.length;
                              curContent = divList[position].id;
                              for (i=0; i<n; i++)
                              {

                                  for (j=0; j<strColorPairs.length; j++)
                                  {
                                      if (strColorPairs[j].position == curContent){
                                          divList[curContent].style.backgroundColor  = strColorPairs[j].color;
                                          }
                                      else {divList[i].style.backgroundColor  = 'gray'}
                                  }
                              }
                          }
                          //function to assign the position in the array base on the data value recived
                      function checkPosition(num){
                       var position;
                         if((num==1))
                           {
                            position=0;
                           }
                           return position;
                       }
                    });

                    fault_listener.subscribe(function(message) {


                      var val_data = message.data;
                      var num =val_data;
                    // array for two leds
                      var strColorPairs = Array(
                                                  {'position' : 0, 'color' : 'green'},
                                              );

                      var position = checkPosition(num);
                      colorBox(position);
                      //function to change the color of leds and reseting it to gray when not in use
                       function colorBox(position)
                          {
                              var divList = document.getElementsByClassName('ratingBox');
                              var i, n = divList.length;
                              curContent = divList[position].id;
                              for (i=0; i<n; i++)
                              {

                                  for (j=0; j<strColorPairs.length; j++)
                                  {
                                      if (strColorPairs[j].position == curContent){
                                          divList[curContent].style.backgroundColor  = strColorPairs[j].color;
                                          }
                                      else {divList[i].style.backgroundColor  = 'gray'}
                                  }
                              }
                          }
                          //function to assign the position in the array base on the data value recived
                      function checkPosition(num){
                       var position;
                         if((num==1))
                           {
                            position=0;
                           }
                           return position;
                       }
                    });

//--------------------Manager State--------------
//-----------------feature state-----------------
                var data_listener = new ROSLIB.Topic({
                  ros : ros,
                  name : '/feature_state',
                  messageType : 'std_msgs/Int32'
                });

//-----------------feature state-----------------


         </script>

         <!-- define on/off styles -->
         <style type="text/css">
          .on  { background:red; }
          .off { background:green; }
         </style>

</head>


<body class="d-flex flex-column h-100">
	<!-- header of the page -->
	<header class="header">
		<div class="container">
			<div class="jumbotron text-center">
				<h1>AD-EYE Graphical Interface</h1>
				<p>Connection status: <span id="status"></span></p>
			</div>
		</div>
	</header>

	<!-- main content -->
	<main>
		<div class="container">
			<div class="row">
                <!-- card for linear velocity -->
                <div class="col-md-4 col-sm-12">
                    <div class="card">
                        <div class="card-body">
                            <h2 class="text-center">Linear Velocity</h2>
                            <div class="gauge">
                                <div class="gauge__body">
                                    <div class="gauge__fill"></div>
                                    <div class="gauge__cover"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- card for linear acceleration -->
				<div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Linear Acceleration</h2>
                            <div class="gauge_a">
                                <div class="gauge_a__body">
                                    <div class="gauge_a__fill"></div>
                                    <div class="gauge_a__cover"></div>
                                </div>
                            </div>
						</div>
					</div>
				</div>
                <!-- card for state -->
                <div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Autoware Vs Safety</h2>
                            <div id="0" class="ratingBox">
                            </div>
                            <p>Autoware</p>
                            <div id="1" class="ratingBox">
                            </div>
                            <p>Safety Channel</p>
						</div>
					</div>
				</div>
                <!-- card for tracked objects -->
                <div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Tracked Objects</h2>
                            <p>Tracked object: <span id="track"></span></p>
                            <p>X: <span id="x"></span></p>
                            <p>Y: <span id="y"></span></p>
                            <p>Z: <span id="z"></span></p>
						</div>
					</div>
				</div>
                <!-- card for behaviour state -->
                <div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Behavior State</h2>
                            <p>State: <span id="beh"></span></p>
						</div>
					</div>
				</div>
                <div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Toggle State</h2>
                            <button type="button" class="off"
                             onclick="toggleState(this)">A Vs S</button>
						</div
                        >
					</div>
				</div>
                <div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">State Change</h2>
                            <button type="button" class="off"
                             onclick="toggleStateinitial(this)">Initial</button>
                             <button type="button"  class="off"
                              onclick="toggleStateactivation(this)">Activation</button>
                             <button type="button" class="off"
                              onclick="toggleStatefault(this)">Fault</button>

						</div>
					</div>
				</div>
                <div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Camera Stream_tl</h2>

						</div>
					</div>
				</div>
                <div class="col-md-4 col-sm-12">
					<div class="card">
						<div class="card-body">
							<h2 class="text-center">Manager State</h2>
                            <div id="0" class="ratingBoxs">
                            </div>
                            <p>Initiaizing</p>
                            <div id="1" class="ratingBoxs">
                            </div>
                            <p>Enable</p>
                            <div id="2" class="ratingBoxs">
                            </div>
                            <p>Fault</p>
						</div>
					</div>
				</div>
            </div>
	</main>

	<!-- footer -->
	<footer class="footer mt-auto bg-dark text-light">
		<div class="container">
			<h5>page ends here! But work inprogress</h5>
		</div>
	</footer>
</body>


</html>
