<!DOCTYPE html>
<html>
    <head>
        <title> CSS </title>
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
       <meta charset="utf-8">
       <script type="js/main.js"></script>
       <link rel="stylesheet" href="gauge.css">

       <script>

               var ros = new ROSLIB.Ros({
                 url : 'ws://localhost:9090'
               });

               ros.on('connection', function() {
                 document.getElementById("status").innerHTML = "Connected";
               });

               ros.on('error', function(error) {
                 document.getElementById("status").innerHTML = "Error";
               });

               ros.on('close', function() {
                 document.getElementById("status").innerHTML = "Closed";
               });

               var data_listener = new ROSLIB.Topic({
                 ros : ros,
                 name : '/switchCommand',
                 messageType : 'std_msgs/Int32'
               });

               data_listener.subscribe(function(message) {
                console.log('Received message on ' + data_listener.name + ': ' + message.data);
                 document.getElementById("acc").innerHTML = message.data;
                //vel_listener.unsubscribe();
                var val_data = message.data;

               /*const gaugeElement_a = document.querySelector(".gauge_a");
               val_a = val_a / 10;
                function setGaugeValue_a(gauge_a, value_a) {
                  if (value_a < 0 || value_a > 1) {
                    return;
                  }

                  gauge_a.querySelector(".gauge_a__fill").style.transform = `rotate(${value_a / 4}turn)`;

                  gauge_a.querySelector(".gauge_a__cover").textContent = `${Math.round(value_a*10 )}m/s2`;
                }

                setGaugeValue_a(gaugeElement_a, val_a);*/



                var num =val_data;
                var strColorPairs = Array(
                                            {'position' : 0, 'color' : 'green'},
                                            {'position' : 1, 'color' : 'red'}
                                        );

                var position = checkPosition(num);


                colorBox(position);
                 function colorBox(position)
                    {
                        var divList = document.getElementsByClassName('ratingBox');
                        var i, n = divList.length;
                        curContent = divList[position].id;
                        console.log(curContent);
                        for (i=0; i<n; i++)
                        {

                            for (j=0; j<strColorPairs.length; j++)
                            {
                                if (strColorPairs[j].position == curContent){
                                    divList[curContent].style.backgroundColor  = strColorPairs[j].color;
                                    }
                                else {divList[i].style.backgroundColor  = 'gray'}
                            }
                        }
                    }

                function checkPosition(num){
                 var position;
                   if((num==0))
                     {
                      position=0;
                     }
                     else if((num==1))
                     {
                      position=1;
                     }

                     return position;
                 }










            });















       </script>
   </head>
   <body>
       <h1>AD-EYE Graphical Interface</h1>
       <p>Connection status: <span id="status"></span></p>
       <p>Last /txt_msg received: <span id="acc"></span></p>
       <div id="0" class="ratingBox"></div>
       <p>Safety Channel</p>
       <div id="1" class="ratingBox"></div>
       <p>Autoware</p>


    </body>
 </html>
